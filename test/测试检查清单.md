# 🧪 API测试检查清单

## 快速测试步骤

### 准备工作
- [ ] 启动服务器：`python run.py`
- [ ] 导入Postman集合：`postman_collection.json`
- [ ] 导入环境变量：`postman_environment.json`
- [ ] 选择环境：`校园食堂系统环境`

### 核心功能测试（必测）

#### 🔐 认证功能
- [ ] 管理员登录（admin/admin123）→ 获得admin_token
- [ ] 用户注册（student1/123456）
- [ ] 用户登录（student1/123456）→ 获得user_token

#### 📋 基础数据
- [ ] 获取食堂列表 → 应该看到2个食堂
- [ ] 获取菜品列表 → 应该看到9个菜品
- [ ] 获取菜品详情 → 宫保鸡丁等

#### ⭐ 评价系统
- [ ] 创建评价（需user_token）→ 五个维度评分
- [ ] 获取评价列表 → 看到刚创建的评价
- [ ] 点赞评价 → 点赞数+1
- [ ] 回复评价 → 添加回复内容

#### 📊 统计功能
- [ ] 系统概览统计 → 用户数、菜品数等
- [ ] 热门菜品统计 → 按评价数排序
- [ ] 评分分布统计 → 各星级数量

#### 👑 管理员功能（需admin_token）
- [ ] 查看用户列表 → 包含admin和student1
- [ ] 创建新食堂 → 第三食堂
- [ ] 创建新窗口 → 测试窗口
- [ ] 创建新菜品 → 测试菜品

#### 🤖 AI菜品识别功能（需user_token）**新功能**
- [ ] 菜品图片分类 → 上传图片获取AI识别结果
  - 测试jpg/png/gif格式图片
  - 验证返回菜品ID、名称、置信度
  - 测试无效文件格式（应返回400错误）
- [ ] 菜品分类与推荐 → 上传图片获取识别结果和推荐
  - 验证返回AI识别结果
  - 验证返回相关菜品推荐列表
  - 测试大文件（>5MB，应返回错误）

**AI功能测试注意事项：**
- 确保ResNet模型文件存在：`resnet_classifier/model.pth`
- 确保类别映射文件存在：`resnet_classifier/id_name_mapping.txt`
- 准备测试图片（菜品照片）
- 首次调用可能较慢（模型加载）

### 快速验证

#### 1分钟快速测试
1. 管理员登录
2. 获取食堂列表
3. 用户注册+登录
4. 创建一个评价
5. 查看统计数据

#### 2分钟完整测试（包含AI功能）
1. 管理员登录
2. 获取食堂列表
3. 用户注册+登录
4. **上传菜品图片进行AI识别**
5. 创建一个评价
6. 查看统计数据
7. **测试AI分类推荐功能**

#### 预期结果
- 所有请求返回状态码：200/201
- 数据格式正确（有code、message、data字段）
- token自动保存到环境变量
- 能看到示例数据（2食堂、3窗口、9菜品）

## 🚨 常见错误排查

| 错误 | 原因 | 解决方法 |
|------|------|----------|
| 连接失败 | 服务器未启动 | 运行 `python run.py` |
| 401未授权 | 没有token或token错误 | 重新登录获取token |
| 403权限不足 | 普通用户访问管理员接口 | 使用admin_token |
| 404不存在 | 数据ID错误 | 检查环境变量中的ID |
| 400请求错误 | 参数格式错误 | 检查JSON格式和必填字段 |

## 🎯 测试完成标志

全部测试通过后，您应该看到：
- ✅ 2个默认食堂 + 1个新建食堂
- ✅ 9个默认菜品 + 1个新建菜品  
- ✅ 1个管理员 + 1个普通用户
- ✅ 至少1条菜品评价记录
- ✅ 统计数据正确显示

---

**完成时间**：约10-15分钟  
**测试重点**：认证、评价、管理员功能
